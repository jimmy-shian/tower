<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Text Search</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            }

            .search-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 20px 0 0;
            }

            .search-input {
            width: 55%;
            padding: 10px;
            margin: 10px 20px 10px 0;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
            }

            .search-button {
            padding: 10px 25px;
            margin: 10px;
            width: auto;
            font-size: 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            }

            .search-button:hover {
            background-color: #0056b3;
            }

            .table {
            /* max-width: auto; */
            /* overflow-x: auto; */
            /* resize: vertical; */
            border-collapse: collapse;
            width: 50%;
            /* max-height: 50px; */
            height: 100%;
            flex-direction: column;
            border: 1px solid #ccc;
            margin: 10px;
        }

        .table-row {
            display: inline-flex;
            border-bottom: 1px solid #ccc;
            justify-content: center;
            align-items: center;
        }

        .table-cell {
            overflow-y: auto;
            height: 125px;
            padding: 15px;
            display: inline-flex;
            justify-content: center;
            border-right: 2px solid #c7c7c7;
        }

        .table-cell:last-child {
            border-right: none;
        }

        .table:first-child {
            border: 4px double #000;
        }

        .image-wrapper {
            position: relative;
            width: 40px; /* 與圖片寬度相同 */
            height: auto; /* 自動高度 */
            transition: transform 0.25s; /* 添加平滑過渡效果 */
            /* overflow-clip-margin: 0; */
        }

        .image-wrapper:hover {
            position: fixed;
            transform: scale(2.5); /* 將圖片放大到原尺寸的2倍 */
            z-index: 50;
        }


            .filter-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px;
            padding: 3px;
            }

            .checkbox-label {
            margin-top: 10px;
            justify-content: start;
            align-items: start;
            }

            #raceFilter,
            #attributeFilter {
            justify-content: start;
            align-items: start;
            width: 150px;
            height: 25px;
            border: 1px solid #000;
            }

    </style>

</head>
<body>
    <h1>JSON Text Search</h1>

    <div class="search-container">
      <input type="text" id="searchInput" class="search-input" placeholder="輸入關鍵字..." onkeypress="handleKeyPress(event)">
      <button class="search-button" onclick="searchJSON()">搜尋</button>
    </div>

    <h2 style="margin-left: 20vh;">選擇搜尋欄位：</h2>
    <div class="filter-container">
        <div class="checkbox-label">
          <label class="checkbox-label"><input type="checkbox" data-field="Image Name" checked>卡片名稱</label>
          <label class="checkbox-label"><input type="checkbox" data-field="主動技效果" checked>主動技</label>
          <label class="checkbox-label"><input type="checkbox" data-field="隊長技效果">隊長技</label>
          <label class="checkbox-label"><input type="checkbox" data-field="Team Skills">隊伍技</label>
          <label><input type="checkbox" data-field="最小CD" data-field2="最小EP">最小CD/EP</label>
          
          <div class="checkbox-label">
            <label for="raceFilter" class="checkbox-label">選擇種族：</label>
            <select id="raceFilter" >
              <option value="all">所有種族</option>
              <option value="水屬">水</option>
              <option value="火屬">火</option>
              <option value="木屬">木</option>
              <option value="光屬">光</option>
              <option value="暗屬">暗</option>

            </select>
          </div>
          
          <div class="checkbox-label">
            <label for="attributeFilter" class="checkbox-label">選擇屬性：</label>
            <select id="attributeFilter" >
              <option value="all">所有屬性</option>
              <option value="人類">人類</option>
              <option value="獸類">獸類</option>
              <option value="妖精類">妖精類</option>
              <option value="龍類">龍類</option>
              <option value="神族">神族</option>
              <option value="魔族">魔族</option>
              <option value="機械族">機械族</option>
              <option value="進化素材">進化素材</option>
              <option value="強化素材">強化素材</option>
            </select>
          </div>
          
        </div>
      </div>

    <!-- 其他欄位選項 -->

    <div id="results"></div>
    
    <div class="table-container">
        <div class="table">
          <div class="table-row">
            <div class="table-cell">Cell 1</div>
            <div class="table-cell">Cell 2 with longer text that needs scrolling</div>
            <div class="table-cell">Cell 3</div>
          </div>
        </div>
      </div>

<div style="text-align: center; margin-top: 20px;">
    <!-- <a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.zh_TW" target="_blank">
        <img alt="Creative Commons License" style="border-width:0; width: 120px;" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png" />
    </a><br> -->
    本作品資料來源為：
    <a rel="license" href="https://tos.fandom.com/zh/wiki/%E7%A5%9E%E9%AD%94%E4%B9%8B%E5%A1%94_%E7%B9%81%E4%B8%AD%E7%B6%AD%E5%9F%BA?variant=zh-tw" target="_blank">神魔之塔繁中維基</a>
    ，根據FANDOM社區使用條款以<a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.zh_TW" target="_blank">
        <img alt="Creative Commons License" style="border-width:0; width: 80px;" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png" />
        (CC-BY-SA 3.0) </a>進行使用。
</div><br>

    <script>
        // var searchData = [];
        fetch('https://raw.githubusercontent.com/jimmy-shian/tower/main/final_data.json')
        .then(response => response.json()) // 解析 JSON 資料
            .then(data => {
                // 現在的 data 應該是一個陣列，可以進行迭代
                searchData = data; // 將解析後的資料指派給 searchData
                console.log('search data is loading');
            })
            .catch(error => {
                console.error('Error fetching or parsing final_data.json:', error);
        });
        fetch('https://raw.githubusercontent.com/jimmy-shian/tower/main/processed_data.json')
        .then(response => response.json()) // 解析 JSON 資料
            .then(data => {
                // 現在的 data 應該是一個陣列，可以進行迭代
                showData = data; // 將解析後的資料指派給 searchData
                console.log('show data is loading');
            })
            .catch(error => {
                console.error('Error fetching or parsing processed_data.json:', error);
        });
            // function createResultItem(item, index) {
            //     var values = Object.values(item[index]);
            // };
            // 定义一个名为 searchJSON 的函数，用于执行搜索操作
            function searchJSON() {
                // 获取搜索关键字输入框的值，并转换为小写
                var searchKeyword = document.getElementById("searchInput").value.toLowerCase();
                // 获取用于显示结果的 <div> 元素
                var resultsDiv = document.getElementById("results");
                // 获取选择的字段数组
                var selectedFields = getSelectedFields();
                // 获取选择的种族值
                var raceFilter = document.getElementById("raceFilter").value;
                // 获取选择的属性值
                var attributeFilter = document.getElementById("attributeFilter").value;
                console.log(raceFilter, attributeFilter);
                // 清空结果显示区域
                resultsDiv.innerHTML = "";

                // 遍历 searchData 数组中的每个数据项，同时追踪索引
                searchData.forEach((item, index) => {
                    // 初始化是否匹配标志为 false
                    var match = false;

                    // 如果选择的种族值和属性值与数据项的值匹配，继续执行
                    if ((raceFilter === "all" || item["種族"] === raceFilter) &&
                        (attributeFilter === "all" || item["屬性"] === attributeFilter)) {
                        // 遍历选择的字段数组
                        selectedFields.forEach(field => {
                            // 获取字段值，并转换为小写
                            var fieldValue = item[field.fieldName].toLowerCase();

                            // 将搜索关键字拆分为字符数组
                            var searchCharacters = searchKeyword.split(' ');
                            var currentIndex = 0;

                            // 遍历字段值中的每个字符
                            for (var i = 0; i < fieldValue.length; i++) {
                                // 如果字符匹配搜索关键字中的字符，继续检查下一个字符
                                if (fieldValue[i] === searchCharacters[currentIndex]) {
                                    currentIndex++;
                                    // 如果所有搜索关键字中的字符都匹配，设置匹配标志为 true
                                    if (currentIndex === searchCharacters.length) {
                                        match = true;
                                        break;
                                    }
                                }
                            }
                        });

                        // 如果匹配标志为 true，创建结果项并添加到页面中
                        if (match) {
                            // Retrieve the corresponding HTML table row from the showData array
                            var htmlTableRow = showData[index];

                            // Create a temporary <div> element
                            var tempDiv = document.createElement("div");

                            // Set the innerHTML of the <div> to the HTML table row
                            tempDiv.innerHTML = htmlTableRow;

                            // Append the contents of the <div> to the resultsDiv
                            while (tempDiv.firstChild) {
                                resultsDiv.appendChild(tempDiv.firstChild);
                            }
                        }
                    }
                });
            }

        function getSelectedFields() {
            var selectedFields = [];
            var checkboxes = document.querySelectorAll("input[type=checkbox]:checked");

            checkboxes.forEach(checkbox => {
                var fieldName = checkbox.getAttribute("data-field");

                selectedFields.push({
                    fieldName: fieldName
                });
            });

            return selectedFields;
        }

        // ... 其他代码

        function handleKeyPress(event) {
            if (event.keyCode === 13) {
                searchJSON(); // 在按下 Enter 键时触发搜索功能
            }
        }


// ... 其他代码

    </script>
</body>
</html>
