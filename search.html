<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Text Search</title>
    <style>
        /* 在此添加你的 CSS */
    </style>
</head>
<body>
    <h1>JSON Text Search</h1>
    <input type="text" id="searchInput" placeholder="輸入關鍵字...">
    <button onclick="searchJSON()">搜尋</button>

    <h2>選擇搜尋欄位：</h2>
    <label><input type="checkbox" data-field="Image Name">卡片名稱</label>
    <!-- <label><input type="checkbox" data-field="Data Url">Data Url</label> -->
    <label><input type="checkbox" data-field="屬性">屬性</label>
    <div>
        <label for="raceFilter">選擇種族：</label>
        <label><input type="checkbox" data-field="主動技效果">主動技</label>
        <label><input type="checkbox" data-field="隊長技效果">隊長技</label>
        <label><input type="checkbox" data-field="Team Skills">隊伍技</label>
        <select id="raceFilter">
            <option value="all">所有種族</option>
            <option value="人類">人類</option>
            <option value="魔族">魔族</option>
            <option value="獸族">獸族</option>
            <!-- 添加其他種族選項 -->
        </select>
    </div>
    <label><input type="checkbox" data-field="最小CD" data-field2="最小EP">最小CD/EP</label>
    <!-- 其他欄位選項 -->

    <div id="results"></div>

    <script>
        // var searchData = [];
        fetch('https://raw.githubusercontent.com/jimmy-shian/tower/main/final_data.json')
        .then(response => response.json()) // 解析 JSON 資料
            .then(data => {
                // 現在的 data 應該是一個陣列，可以進行迭代
                searchData = data; // 將解析後的資料指派給 searchData
            })
            .catch(error => {
                console.error('Error fetching or parsing data:', error);
        });
        
        function searchJSON() {
            var searchKeyword = document.getElementById("searchInput").value.toLowerCase();
            var resultsDiv = document.getElementById("results");
            var selectedFields = getSelectedFields();
            var raceFilter = document.getElementById("raceFilter").value; // 取得選中的種族值

            resultsDiv.innerHTML = "";

            searchData.forEach(item => {
                var match = false;

                selectedFields.forEach(field => {
                    if (item[field.fieldName]) {
                        var fieldValue = item[field.fieldName].toLowerCase();

                        // 將搜尋關鍵字分割成單個字元
                        var searchCharacters = searchKeyword.split('');

                        // 依次尋找每個字元是否按順序出現在資料的特定欄位中
                        var currentIndex = 0;
                        for (var i = 0; i < fieldValue.length; i++) {
                            if (fieldValue[i] === searchCharacters[currentIndex]) {
                                currentIndex++;
                                if (currentIndex === searchCharacters.length) {
                                    // if (raceFilter === "all" || item["種族"] === raceFilter) {
                                        // if (/*...其他條件*/) {
                                            match = true;
                                            break;
                                        // }
                                }
                            }
                        }
                    }
                });

                // ...
                if (match) {
    // 創建一個 <div> 元素，用來顯示符合條件的資料
    var resultItem = document.createElement("div");
    resultItem.style.height = "150px"; // 設定高度
    resultItem.style.width = "100%"; // 設定寬度為100%
    resultItem.style.overflowX = "scroll"; // 橫向捲動效果
    resultItem.style.display = "flex"; // 使用 flex 布局
    resultItem.style.flexDirection = "row"; // 橫向排列
    resultItem.style.justifyContent = "center"; // 左右居中對齊
    resultItem.style.alignItems = "flex-start"; // 靠上對齊
    resultItem.style.borderBottom = "1px solid black"; // 加入下邊框

    // 創建一個 <table> 元素，用來顯示資料的表格
    var table = document.createElement("table");
    table.style.tableLayout = "fixed"; // 固定表格寬度
    table.style.width = "100%"; // 設定表格寬度為100%
    table.style.borderCollapse = "collapse"; // 合併邊框

    // 創建表格的表頭行，僅在第一次顯示時添加
    if (resultsDiv.children.length === 0) {
        var tableHeader = document.createElement("tr");
        var headers = Object.keys(item);

        headers.forEach(header => {
            var th = document.createElement("th");
            th.style.border = "1px solid black";
            th.style.padding = "5px";
            th.style.width = "75px";
            th.textContent = header;
            th.style.textAlign = "center";

            tableHeader.appendChild(th);
        });

        table.appendChild(tableHeader);
    }

    var tableRow = document.createElement("tr");
    var values = Object.values(item);

    values.forEach((value, index) => {
        var td = document.createElement("td");
        td.style.border = "1px solid black";
        td.style.padding = "5px";
        td.style.width = "75px";
        td.style.whiteSpace = "normal";
        td.style.textAlign = "center";

        if (index === 1) {
            var link = document.createElement("a");
            link.href = value;
            link.textContent = "點擊前往";
            link.target = "_blank";
            td.appendChild(link);
        } else {
            td.textContent = value;
        }

        tableRow.appendChild(td);
    });

    // 將資料行加入表格中
    table.appendChild(tableRow);

    // 將表格加入用來顯示結果的 <div> 元素中
    resultItem.appendChild(table);

    // 將整個結果 <div> 加入用來顯示結果的 <div> 元素中
    resultsDiv.appendChild(resultItem);

    // 創建分隔線
    var separator = document.createElement("hr");
    separator.style.marginTop = "10px"; // 加入間距
    resultsDiv.appendChild(separator);
}




            });
        }

        function getSelectedFields() {
            var selectedFields = [];
            var checkboxes = document.querySelectorAll("input[type=checkbox]:checked");

            checkboxes.forEach(checkbox => {
                var fieldName = checkbox.getAttribute("data-field");

                selectedFields.push({
                    fieldName: fieldName
                });
            });

            return selectedFields;
        }
    </script>
</body>
</html>
